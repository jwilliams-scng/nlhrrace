<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SCNG • NL Home Run Race</title>
  <style>
    :root { color-scheme: light only; }
    html, body { margin:0; padding:0; }
    body {
      padding: 12px 12px 0;          /* no gap beneath iframe */
      font: 14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:#fff; overflow-x:hidden;
    }
    .wrap { max-width:740px; margin:0 auto; }
    .card {
      background:#fff; border:1px solid #e5e7eb; border-radius:16px;
      box-shadow:0 1px 2px rgba(0,0,0,.04); overflow:hidden;
    }
    header {
      display:flex; justify-content:space-between; align-items:center; padding:12px;
      background:linear-gradient(90deg,var(--p,#0d47a1),var(--a,#1976d2)); color:#fff;
    }
    header h3 { margin:0; font-size:16px; letter-spacing:.2px; font-weight:800; }
    header .meta { font-size:12px; opacity:.95; }
    .diag { display:none; font-size:12px; background:#fff8c5; border:1px solid #fde68a;
            color:#7c3e11; border-radius:10px; padding:6px 10px; margin:8px 12px; }
    .body { padding:12px; }
    .body > :last-child { margin-bottom:0; }
    .note { font-size:12px; color:#6b7280; margin:6px 0 12px; }

    /* race strip */
    .race { padding:6px 0 12px; }
    .race .labels { display:flex; justify-content:space-between; font-size:13px; }
    .race .bar { height:10px; background:#e5e7eb; border-radius:999px; position:relative; overflow:hidden; margin:6px 0; }
    .race .fill { position:absolute; top:0; bottom:0; width:50%; background:#fff; opacity:.7; transition:width .3s ease; }

    /* table */
    table { width:100%; border-collapse:separate; border-spacing:0; font-size:14px; border-bottom:1px solid #e5e7eb; }
    th, td { padding:10px 12px; text-align:left; border-bottom:1px solid #e5e7eb; vertical-align:middle; white-space:nowrap; }
    tbody tr:last-child td { border-bottom:0; }
    th { font-size:12px; text-transform:uppercase; letter-spacing:.06em; color:#6b7280; background:#fafafa; position:sticky; top:0; }
    tbody tr:nth-child(even) { background:#f6f7f9; }
    tbody tr.leader { background:#fff7cc; }
    td.num { text-align:right; font-variant-numeric: tabular-nums; }

    @media (max-width:480px){
      th.hide-sm, td.hide-sm { display:none; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h3>NL Home Run Race</h3>
        <div class="meta"></div>
      </header>

      <div id="diag" class="diag"></div>

      <div class="body">
        <div class="race">
          <div class="labels"><div id="l1"></div><div id="l2"></div></div>
          <div class="bar"><div class="fill" id="bar"></div></div>
          <div class="labels"><div id="lead"></div><div>Regular season • NL</div></div>
        </div>

        <table aria-label="NL home run leaders">
          <thead>
            <tr>
              <th>#</th>
              <th>Player</th>
              <th>Team</th>
              <th class="num">HR</th>
              <th class="num hide-sm">RBI</th>
              <th class="num hide-sm">AB</th>
            </tr>
          </thead>
          <tbody id="rows">
            <tr><td colspan="6" class="note">Loading leaders…</td></tr>
          </tbody>
        </table>

        <div class="note" id="asof"></div>
      </div>
    </div>
  </div>

  <script>
  (async () => {
    /* ---------- Branding (auto from referrer or ?brand=ocr etc.) ---------- */
    const brandMap = {
      'dailynews.com':'ladn','ocregister.com':'ocr','sgvtribune.com':'sgv','dailybreeze.com':'db',
      'presstelegram.com':'pt','sbsun.com':'sbs','dailybulletin.com':'ivdb','pasadenastarnews.com':'psn',
      'whittierdailynews.com':'wdn','dailypilot.com':'dp'
    };
    const brandColors = {
      ladn:['#0d47a1','#1976d2'], ocr:['#0b3d91','#1e88e5'], sgv:['#334155','#64748b'],
      db:['#0f766e','#14b8a6'], pt:['#1f2937','#4b5563'], sbs:['#7c2d12','#ea580c'],
      ivdb:['#3b0764','#7c3aed'], psn:['#111827','#374151'], wdn:['#27272a','#52525b'],
      dp:['#1e3a8a','#2563eb'], default:['#0d47a1','#1976d2']
    };
    const qs = new URLSearchParams(location.search);
    const forceBrand = (qs.get('brand')||'').toLowerCase();
    let host = '';
    try { host = new URL(document.referrer).hostname.toLowerCase().replace(/^www\./,''); } catch(e) {}
    const [p,a] = (brandColors[forceBrand || brandMap[host] || 'default'] || brandColors.default);
    document.documentElement.style.setProperty('--p', p);
    document.documentElement.style.setProperty('--a', a);

    /* ---------- Elements ---------- */
    const rowsEl = document.getElementById('rows');
    const l1 = document.getElementById('l1');
    const l2 = document.getElementById('l2');
    const bar = document.getElementById('bar');
    const leadEl = document.getElementById('lead');
    const metaEl = document.querySelector('.meta');
    const asofEl = document.getElementById('asof');
    const diagEl = document.getElementById('diag');
    const DEBUG = new URLSearchParams(location.search).has('diag');
    const log = (msg) => {
      if (!DEBUG) return;
      diagEl.style.display = 'block';
      diagEl.textContent += (diagEl.textContent ? ' • ' : 'Diag: ') + msg;
    };
    const int0 = n => (isFinite(n) ? Number(n).toFixed(0) : '—');

    /* ---------- Load local JSON generated by GitHub Action ---------- */
    try {
      const res = await fetch('./data/nl-hr.json?v=' + Date.now(), { cache: 'no-store' });
      log('fetch ' + res.status);
      if (!res.ok) throw new Error('data ' + res.status);
      const data = await res.json();
      const leaders = Array.isArray(data?.leaders) ? data.leaders.slice() : [];
      if (!leaders.length) throw new Error('no rows');

      // Meta bar (season + updated)
      const updated = data.updated ? new Date(data.updated) : new Date();
      const season  = data.season || updated.getUTCFullYear();
      metaEl.textContent = `${season} • Updated ${updated.toLocaleString(undefined,{hour:'2-digit',minute:'2-digit',month:'short',day:'numeric'})}`;

      // Sort & top 10
      leaders.sort((a,b)=> (b.hr - a.hr) || (b.rbi - a.rbi) || (b.ab - a.ab));
      const top10 = leaders.slice(0,10);

      // Race strip
      const [one,two] = top10;
      l1.textContent = `${(one.name||'').split(' ').slice(-1)[0]} ${int0(one.hr)}`;
      l2.textContent = `#2 ${int0(two.hr)}`;
      const diff = (one.hr||0) - (two.hr||0);
      bar.style.width = (50 + Math.max(-6, Math.min(6, diff)) * 5) + '%';
      leadEl.textContent = `Lead: ${int0(diff)} HR`;

      // Table
      rowsEl.innerHTML = top10.map((r,i)=>`
        <tr class="${i===0?'leader':''}">
          <td>${i+1}</td>
          <td>${r.name||''}</td>
          <td>${r.team||''}</td>
          <td class="num">${int0(r.hr||0)}</td>
          <td class="num hide-sm">${int0(r.rbi||0)}</td>
          <td class="num hide-sm">${int0(r.ab||0)}</td>
        </tr>
      `).join('');

      asofEl.textContent = `As of ${updated.toLocaleString(undefined,{dateStyle:'medium',timeStyle:'short'})} • Regular season • NL`;
    } catch (err) {
      rowsEl.innerHTML = `<tr><td colspan="6" class="note">Leaders temporarily unavailable.</td></tr>`;
      if (DEBUG) {
        diagEl.style.display = 'block';
        diagEl.textContent = 'Diag: ' + (err?.message || 'failed to load ./data/nl-hr.json');
      }
    }
  })();
  </script>
</body>
</html>
